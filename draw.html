<head>
    <meta charset="utf-8">
    <script src="draw.js" defer></script>
</head>
<body>
    <canvas id="canvas" width='800' height='800'></canvas>
</body>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Canvas 畫圖工具</title>
<style>
  body { text-align: center; font-family: sans-serif; }
  canvas { border: 1px solid #000; cursor: crosshair; }
  .toolbar { margin: 10px; }
  button { margin: 0 5px; }
</style>
</head>
<body>

<h2>🎨 Canvas 畫圖工具</h2>

<div class="toolbar">
  顏色：
  <input type="color" id="color" value="#000000">
  線條粗細：
  <input type="range" id="lineWidth" min="1" max="30" value="5">
  <span id="value">5</span> px　
  
  <button id="eraser">🩹 橡皮擦</button>
  <button id="clear">🧹 清除畫布</button>
  <button id="download">💾 下載圖片</button>
</div>

<canvas id="canvas" width="800" height="500"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let drawing = false;   // 是否正在畫
let queue = [];        // 暫存上一個座標
let erasing = false;   // 是否啟用橡皮擦

// 畫線函式
function drawLine(ctx, x1, y1, x2, y2) {
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
    ctx.closePath();
}

// 滑鼠按下開始畫
canvas.addEventListener('mousedown', function(e) {
    drawing = true;
    const x = e.pageX - canvas.offsetLeft;
    const y = e.pageY - canvas.offsetTop;
    drawLine(ctx, x, y, x, y);
    queue.push([x, y]);
});

// 滑鼠移動畫線
canvas.addEventListener('mousemove', function(e) {
    if (drawing) {
        const old = queue.shift();
        const x = e.pageX - canvas.offsetLeft;
        const y = e.pageY - canvas.offsetTop;
        drawLine(ctx, old[0], old[1], x, y);
        queue.push([x, y]);
    }
});

// 放開滑鼠結束畫圖
canvas.addEventListener('mouseup', function() {
    drawing = false;
    queue = [];
});

// 顏色與粗細控制
const color = document.getElementById("color");
const lineWidth = document.getElementById("lineWidth");
const value = document.getElementById("value");

value.textContent = lineWidth.value;
ctx.strokeStyle = color.value;
ctx.lineWidth = lineWidth.value;

color.addEventListener("input", (e) => {
    ctx.strokeStyle = e.target.value;
    erasing = false; // 切換顏色即回到畫筆模式
}); 

lineWidth.addEventListener("input", (e) => {
    value.textContent = e.target.value;
    ctx.lineWidth = e.target.value;
});

// 🩹 橡皮擦功能
const eraserBtn = document.getElementById("eraser");
eraserBtn.addEventListener("click", () => {
    erasing = !erasing;
    if (erasing) {
        ctx.strokeStyle = "#FFFFFF"; // 背景色
        eraserBtn.textContent = "✏️ 回到畫筆";
    } else {
        ctx.strokeStyle = color.value;
        eraserBtn.textContent = "🩹 橡皮擦";
    }
});

// 🧹 清除畫布
const clearBtn = document.getElementById("clear");
clearBtn.addEventListener("click", () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
});

// 💾 下載圖片
const downloadBtn = document.getElementById("download");
downloadBtn.addEventListener("click", () => {
    const link = document.createElement('a');
    link.download = 'my_drawing.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
});
</script>

</body>
</html>
