<head>
    <meta charset="utf-8">
    <script src="draw.js" defer></script>
</head>
<body>
    <canvas id="canvas" width='800' height='800'></canvas>
</body>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Canvas ç•«åœ–å·¥å…·</title>
<style>
  body { text-align: center; font-family: sans-serif; }
  canvas { border: 1px solid #000; cursor: crosshair; }
  .toolbar { margin: 10px; }
  button { margin: 0 5px; }
</style>
</head>
<body>

<h2>ğŸ¨ Canvas ç•«åœ–å·¥å…·</h2>

<div class="toolbar">
  é¡è‰²ï¼š
  <input type="color" id="color" value="#000000">
  ç·šæ¢ç²—ç´°ï¼š
  <input type="range" id="lineWidth" min="1" max="30" value="5">
  <span id="value">5</span> pxã€€
  
  <button id="eraser">ğŸ©¹ æ©¡çš®æ“¦</button>
  <button id="clear">ğŸ§¹ æ¸…é™¤ç•«å¸ƒ</button>
  <button id="download">ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡</button>
</div>

<canvas id="canvas" width="800" height="500"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let drawing = false;   // æ˜¯å¦æ­£åœ¨ç•«
let queue = [];        // æš«å­˜ä¸Šä¸€å€‹åº§æ¨™
let erasing = false;   // æ˜¯å¦å•Ÿç”¨æ©¡çš®æ“¦

// ç•«ç·šå‡½å¼
function drawLine(ctx, x1, y1, x2, y2) {
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
    ctx.closePath();
}

// æ»‘é¼ æŒ‰ä¸‹é–‹å§‹ç•«
canvas.addEventListener('mousedown', function(e) {
    drawing = true;
    const x = e.pageX - canvas.offsetLeft;
    const y = e.pageY - canvas.offsetTop;
    drawLine(ctx, x, y, x, y);
    queue.push([x, y]);
});

// æ»‘é¼ ç§»å‹•ç•«ç·š
canvas.addEventListener('mousemove', function(e) {
    if (drawing) {
        const old = queue.shift();
        const x = e.pageX - canvas.offsetLeft;
        const y = e.pageY - canvas.offsetTop;
        drawLine(ctx, old[0], old[1], x, y);
        queue.push([x, y]);
    }
});

// æ”¾é–‹æ»‘é¼ çµæŸç•«åœ–
canvas.addEventListener('mouseup', function() {
    drawing = false;
    queue = [];
});

// é¡è‰²èˆ‡ç²—ç´°æ§åˆ¶
const color = document.getElementById("color");
const lineWidth = document.getElementById("lineWidth");
const value = document.getElementById("value");

value.textContent = lineWidth.value;
ctx.strokeStyle = color.value;
ctx.lineWidth = lineWidth.value;

color.addEventListener("input", (e) => {
    ctx.strokeStyle = e.target.value;
    erasing = false; // åˆ‡æ›é¡è‰²å³å›åˆ°ç•«ç­†æ¨¡å¼
}); 

lineWidth.addEventListener("input", (e) => {
    value.textContent = e.target.value;
    ctx.lineWidth = e.target.value;
});

// ğŸ©¹ æ©¡çš®æ“¦åŠŸèƒ½
const eraserBtn = document.getElementById("eraser");
eraserBtn.addEventListener("click", () => {
    erasing = !erasing;
    if (erasing) {
        ctx.strokeStyle = "#FFFFFF"; // èƒŒæ™¯è‰²
        eraserBtn.textContent = "âœï¸ å›åˆ°ç•«ç­†";
    } else {
        ctx.strokeStyle = color.value;
        eraserBtn.textContent = "ğŸ©¹ æ©¡çš®æ“¦";
    }
});

// ğŸ§¹ æ¸…é™¤ç•«å¸ƒ
const clearBtn = document.getElementById("clear");
clearBtn.addEventListener("click", () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
});

// ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡
const downloadBtn = document.getElementById("download");
downloadBtn.addEventListener("click", () => {
    const link = document.createElement('a');
    link.download = 'my_drawing.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
});
</script>

</body>
</html>
